---
import siteConfig from "../site.config";

const title = siteConfig.subscribe?.title ?? "Newsletter";
const desc =
  siteConfig.subscribe?.text ??
  "Satu update per pekan. Artikel terbaru langsung ke inbox Anda.";

/**
 * IMPORTANT:
 * Gunakan endpoint API Substack bawaan publikasi kamu,
 * bukan /subscribe. Endpoint yang benar:
 *   https://<subdomain>.substack.com/api/v1/free
 * Nanti Substack yang handle konfirmasi.
 */
const SUBSTACK_API = "https://twotworial.substack.com/api/v1/free";

// halaman tujuan setelah submit (opsional). Bisa pakai halaman kamu sendiri.
const REDIRECT_URL = "https://twotworial.substack.com/welcome";
---

<section id="subscribe" class="my-12 w-full">
  <div
    class="mx-auto max-w-xl rounded-3xl border p-5 sm:p-6"
    style="
      background: color-mix(in oklab, var(--color-paper) 92%, transparent);
      box-shadow:
        inset 0 0 .5px 1px hsla(0,0%,0%,.03),
        0 .3px .4px hsla(0,0%,0%,.02),
        0 1px 1.5px hsla(0,0%,0%,.04);
    "
  >
    <div class="mb-4 text-center">
      <h2 class="mb-1">{title}</h2>
      <p class="text-sm opacity-80">{desc}</p>
    </div>

    <!-- Form custom: kirim ke API Substack -->
    <form
      action={SUBSTACK_API}
      method="post"
      target="_blank"
      class="flex flex-col items-stretch gap-3 sm:flex-row sm:items-center sm:gap-3"
    >
      <!-- important: Substack mendukung field 'email' dan optional 'redirect' -->
      <input type="hidden" name="redirect" value={REDIRECT_URL} />
      <input type="hidden" name="source" value="custom-embed" />

      <label for="email" class="sr-only">Alamat email</label>
      <input
        id="email"
        name="email"
        type="email"
        required
        placeholder="you@email.com"
        class="w-full rounded-3xl border px-5 py-3 outline-none"
        style="
          border: 1px solid color-mix(in oklab, var(--color-ink) 25%, transparent);
          background: color-mix(in oklab, var(--color-paper) 95%, transparent);
        "
      />

      <button
        type="submit"
        class="button-link space-btn-filled w-full rounded-3xl px-6 py-3 sm:w-auto"
      >
        Subscribe
      </button>
    </form>
  </div>
</section>

<style>
  .dark #subscribe .max-w-xl {
    background: color-mix(in oklab, var(--color-paper-inv) 92%, transparent);
    box-shadow:
      inset 0 0 .5px 1px hsla(0,0%,100%,.04),
      0 .3px .4px hsla(0,0%,0%,.02),
      0 1px 1.5px hsla(0,0%,0%,.04);
  }
  .dark #subscribe input[type="email"]{
    background: color-mix(in oklab, var(--color-paper-inv) 90%, transparent);
    border-color: color-mix(in oklab, var(--color-ink-inv) 25%, transparent);
  }
  .dark #subscribe input[type="email"]:focus{
    border-color: var(--color-ink-inv);
    box-shadow: 0 0 0 3px color-mix(in oklab, var(--color-ink-inv) 20%, transparent);
  }
  #subscribe input[type="email"]:focus{
    border-color: var(--color-ink);
    box-shadow: 0 0 0 3px color-mix(in oklab, var(--color-ink) 15%, transparent);
  }
</style>
