---
import siteConfig from "../site.config";

/** Ubah ke true kalau mau tetap pakai iframe Substack */
const useIframe = false;

// teks default
const title = siteConfig.subscribe?.title ?? "Newsletter";
const desc =
  siteConfig.subscribe?.text ??
  "Satu update per pekan. Artikel terbaru langsung ke inbox Anda.";

// form target substack
const SUBSTACK_ACTION = "https://twotworial.substack.com/subscribe";
---

<section id="subscribe" class="my-12 w-full text-center">
  <h2 class="mb-2">{title}</h2>
  <p class="mb-6 text-sm opacity-80">{desc}</p>

  {
    useIframe ? (
      /* =============================
         MODE B: IFRAME (fallback)
         ============================= */
      <div class="mx-auto max-w-xl rounded-3xl border p-4 sm:p-6">
        <iframe
          src="https://twotworial.substack.com/embed"
          width="100%"
          height="180"
          style="border:0;background:transparent"
          frameborder="0"
          scrolling="no"
        />
      </div>
    ) : (
      /* =============================
         MODE A: CUSTOM FORM (RECOMMENDED)
         â€“ tampilan disesuaikan style blog
         ============================= */
      <form
        action={SUBSTACK_ACTION}
        method="post"
        target="_blank"
        class="mx-auto flex max-w-xl flex-col items-stretch gap-3 rounded-3xl border p-4 sm:flex-row sm:items-center sm:gap-3 sm:p-6"
      >
        <!-- Substack butuh name="email"; "embed" optional -->
        <input type="hidden" name="embed" value="1" />
        <label for="email" class="sr-only">Alamat email</label>
        <input
          id="email"
          name="email"
          type="email"
          required
          placeholder="you@email.com"
          class="w-full rounded-3xl border px-5 py-3 outline-none"
        />
        <button
          type="submit"
          class="button-link space-btn-filled w-full rounded-3xl px-6 py-3 sm:w-auto"
        >
          Subscribe
        </button>

        <p class="w-full text-pretty text-left text-[13px] opacity-70 sm:col-span-2">
          Dengan berlangganan, Anda akan diarahkan ke Substack untuk konfirmasi.
        </p>
      </form>
    )
  }
</section>

<style>
  /* Sesuaikan typographic scale global yang sudah kamu pakai */
  #subscribe h2 { font-weight: 700; }
  #subscribe form { 
    background: color-mix(in oklab, var(--color-paper) 92%, transparent);
    box-shadow:
      inset 0 0 .5px 1px hsla(0,0%,0%,.03),
      0 .3px .4px hsla(0,0%,0%,.02),
      0 1px 1.5px hsla(0,0%,0%,.04);
  }
  #subscribe input[type="email"] {
    border: 1px solid color-mix(in oklab, var(--color-ink) 25%, transparent);
    background: color-mix(in oklab, var(--color-paper) 95%, transparent);
  }
  #subscribe input[type="email"]:focus {
    border-color: var(--color-ink);
    box-shadow: 0 0 0 3px color-mix(in oklab, var(--color-ink) 15%, transparent);
  }

  /* Tombol pakai util .space-btn-filled yg sudah ada di global.css */
  #subscribe .space-btn-filled {
    border-radius: 9999px;
  }

  /* Dark mode harmonisasi */
  .dark #subscribe form {
    background: color-mix(in oklab, var(--color-paper-inv) 92%, transparent);
    box-shadow:
      inset 0 0 .5px 1px hsla(0,0%,100%,.04),
      0 .3px .4px hsla(0,0%,0%,.02),
      0 1px 1.5px hsla(0,0%,0%,.04);
  }
  .dark #subscribe input[type="email"] {
    background: color-mix(in oklab, var(--color-paper-inv) 90%, transparent);
    border-color: color-mix(in oklab, var(--color-ink-inv) 25%, transparent);
  }
  .dark #subscribe input[type="email"]:focus {
    border-color: var(--color-ink-inv);
    box-shadow: 0 0 0 3px color-mix(in oklab, var(--color-ink-inv) 20%, transparent);
  }
</style>
