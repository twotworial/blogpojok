---
import { getCollection } from "astro:content";
import MainLayout from "../../layouts/MainLayout.astro";
import siteConfig from "../../site.config";

export async function getStaticPaths() {
  const all = await getCollection("products");
  return all.map((p) => {
    const data: any = p.data;
    const slug = (data.slug || p.id).toString().replace(/\.mdx?$/i, "");
    return { params: { slug }, props: { entry: { ...data, id: p.id, slug } } };
  });
}

const { entry } = Astro.props as { entry: any };
const pageTitle = (entry.metaTitle ?? entry.title) + " — " + siteConfig.title;
const pageDescription = entry.metaDescription ?? entry.excerpt ?? "";
---

<MainLayout activePage="products" pageTitle={pageTitle} description={pageDescription} image={entry.images?.[0]?.src}>
  <section class="page-content text-left">
    <a href="/products/" class="mb-4 inline-flex items-center gap-2 text-sm hover:underline">
      ← Kembali ke Products
    </a>

    <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
      <div>
        {entry.images?.[0] && (
          <img
            src={entry.images[0].src}
            alt={entry.images[0].alt ?? entry.title}
            class="w-full rounded-3xl object-cover"
            loading="eager"
            decoding="async"
          />
        )}
        {entry.images?.slice(1)?.length > 0 && (
          <div class="mt-3 grid grid-cols-3 gap-2">
            {entry.images.slice(1).map((im: any) => (
              <img src={im.src} alt={im.alt ?? entry.title} class="rounded-xl object-cover h-28 w-full" loading="lazy" />
            ))}
          </div>
        )}
      </div>

      <div>
        <h1 class="mb-2 text-balance">{entry.title}</h1>
        {entry.excerpt && <p class="opacity-80 mb-3">{entry.excerpt}</p>}

        <p class="mb-4 text-lg font-semibold">
          {new Intl.NumberFormat("id-ID", { style:"currency", currency: entry.currency ?? "IDR" }).format(entry.price)}
        </p>

        {entry.url && (
          <a href={entry.url} class="button-link space-btn-filled">Beli / Hubungi</a>
        )}

        {entry.tags?.length > 0 && (
          <p class="mt-4 text-sm opacity-70">Tag: {entry.tags.join(", ")}</p>
        )}
      </div>
    </div>
  </section>
</MainLayout>
